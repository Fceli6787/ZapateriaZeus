<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Normalizaci√≥n de BD ‚Ä¢ Zapater√≠a (1FN ‚Üí 3FN)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: { 
              50:'#fef3c7',
              100:'#fde68a',
              200:'#fcd34d',
              300:'#fbbf24',
              400:'#f59e0b',
              500:'#d97706',
              600:'#b45309',
              700:'#92400e',
              800:'#78350f',
              900:'#451a03' 
            }
          },
          boxShadow: { 
            soft: '0 10px 25px -8px rgba(251, 191, 36, .25)',
            'colorful': '0 20px 40px -8px rgba(251, 191, 36, .35)',
            'pop': '5px 5px 0px 0px rgba(0,0,0,1)'
          },
          keyframes: {
            'fade-up': { '0%':{opacity:'0',transform:'translateY(8px) scale(.98)'}, '100%':{opacity:'1',transform:'translateY(0) scale(1)'} },
            'pulse-soft': { '0%,100%':{boxShadow:'0 0 0 0 rgba(251, 191, 36,.35)'}, '50%':{boxShadow:'0 0 0 12px rgba(251, 191, 36,.0)'} },
            'wiggle': { '0%, 100%': { transform: 'rotate(-3deg)' }, '50%': { transform: 'rotate(3deg)' } },
            'bounce-slow': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
            'gradient': { '0%, 100%': { backgroundPosition: '0% 50%' }, '50%': { backgroundPosition: '100% 50%' } }
          },
          animation: { 
            'fade-up':'fade-up .45s cubic-bezier(.2,.8,.2,1)',
            'pulse-soft':'pulse-soft 1.6s ease-out infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
            'bounce-slow': 'bounce-slow 2s ease-in-out infinite',
            'gradient': 'gradient 15s ease infinite'
          },
          backgroundImage: {
            'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
            'gradient-fun': 'linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab)'
          }
        }
      }
    }
  </script>
  <style>
    /* Fondo animado con patrones */
    body {
      background-color: #fef3c7;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(34, 211, 238, 0.1) 0%, transparent 50%);
      background-attachment: fixed;
    }
    
    /* Tabs m√°s divertidos */
    .tab-btn {
      position: relative;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px solid #000;
      font-weight: 600;
      transition: all 0.3s ease;
      transform: perspective(1px) translateZ(0);
    }
    
    .tab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 5px 5px 0px 0px rgba(0,0,0,1);
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    }
    
    .tab-active {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      box-shadow: 5px 5px 0px 0px rgba(0,0,0,1);
      color: white;
      transform: translateY(-2px);
    }
    
    /* Cards con estilo neomorphico colorido */
    .card-fun {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(254,243,199,0.9) 100%);
      border: 3px solid #000;
      border-radius: 20px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .card-fun:hover {
      transform: translateY(-4px) rotate(-0.5deg);
      box-shadow: 8px 8px 0px 0px rgba(0,0,0,1);
    }
    
    /* Headers m√°s divertidos */
    h2 {
      background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: inline-block;
      font-weight: 800;
    }
    
    h3 {
      color: #92400e;
      position: relative;
      display: inline-block;
    }
    
    h3::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: #fbbf24;
      border-radius: 2px;
    }
    
    /* Tablas m√°s coloridas */
    table {
      background: white;
      overflow: hidden;
    }
    
    thead {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      font-weight: 700;
    }
    
    tbody tr {
      transition: all 0.2s ease;
    }
    
    tbody tr:hover {
      background: rgba(251, 191, 36, 0.1);
      transform: scale(1.02);
    }
    
    tbody tr:nth-child(even) {
      background: rgba(254, 243, 199, 0.5);
    }
    
    /* Botones m√°s divertidos */
    button:not(.tab-btn) {
      position: relative;
      transition: all 0.3s ease;
      font-weight: 600;
      border: 2px solid #000;
    }
    
    button:not(.tab-btn):hover {
      transform: translateY(-2px);
      box-shadow: 4px 4px 0px 0px rgba(0,0,0,1);
    }
    
    #btn-voice {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      animation: bounce-slow 3s ease-in-out infinite;
    }
    
    #btn-stop-voice {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    /* C√≥digo m√°s divertido */
    code {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: 2px 8px;
      border-radius: 6px;
      font-weight: 600;
      color: #92400e;
      border: 1px solid #fbbf24;
    }
    
    /* Scrollbars personalizados */
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    
    ::-webkit-scrollbar-track {
      background: #fef3c7;
      border-radius: 6px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 6px;
      border: 2px solid #fef3c7;
    }
    
    /* Aside cards especiales */
    .aside-card {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 3px solid #000;
      position: relative;
      overflow: hidden;
    }
    
    .aside-card::before {
      content: 'üí°';
      position: absolute;
      top: -20px;
      right: -20px;
      font-size: 80px;
      opacity: 0.1;
      transform: rotate(-15deg);
    }
    
    /* Header m√°s divertido */
    header {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(254,243,199,0.95) 100%);
      border-bottom: 3px solid #000;
    }
    
    /* Footer m√°s divertido */
    footer {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      border-top: 3px solid #000;
    }
    
    /* Animaci√≥n del logo */
    .logo-shoe {
      animation: wiggle 2s ease-in-out infinite;
      background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
      box-shadow: 4px 4px 0px 0px rgba(0,0,0,1);
    }
    
    /* Select m√°s divertido */
    select {
      border: 2px solid #000;
      background-color: white;
      font-weight: 600;
    }
    
    select:hover {
      box-shadow: 3px 3px 0px 0px rgba(0,0,0,1);
    }
    
    /* Animaci√≥n de entrada */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .panel {
      animation: slideIn 0.5s ease-out;
    }
    
    /* Elementos decorativos */
    .decoration-dot {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #fbbf24;
      border-radius: 50%;
      opacity: 0.3;
    }
    
    /* ERD viewport m√°s divertido */
    #erd-viewport {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 3px solid #000;
      position: relative;
      overflow: hidden;
    }
    
    #erd-viewport::before {
      content: 'üìê';
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 40px;
      opacity: 0.2;
    }
  </style>
</head>
<body class="min-h-screen text-slate-800">
  <header class="sticky top-0 z-30 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center gap-4">
      <div class="flex items-center gap-3">
        <div class="logo-shoe size-12 rounded-xl text-white grid place-content-center text-2xl">üëü</div>
        <div>
          <h1 class="text-lg sm:text-2xl font-black tracking-tight">Normalizaci√≥n de Bases de Datos ‚Äî Caso: Zapater√≠a üöÄ</h1>
          <p class="text-slate-700 text-xs sm:text-sm mt-1">Autores: <strong class="text-brand-600">Maria Camila Murcia Bernal</strong> (ID: 891706) y <strong class="text-brand-600">Andres Felipe Celi Jimenez</strong> (ID: 886628) ‚Ä¢ Materia: <strong>Arquitectura de Datos</strong> ‚Ä¢ NRC: <strong>80131</strong></p>
        </div>
      </div>
      <div class="ml-auto flex items-center flex-wrap gap-2">
        <label for="voice-select" class="sr-only">Voz</label>
        <select id="voice-select" class="rounded-xl px-3 py-2 text-sm min-w-[180px]" title="Selecciona la voz">
          <option value="">üé§ Voz (auto)</option>
        </select>
        <button id="btn-voice" class="rounded-xl text-white px-4 py-2 text-sm shadow-pop">üîä Explicaci√≥n con voz</button>
        <button id="btn-stop-voice" class="rounded-xl text-white px-4 py-2 text-sm shadow-pop">‚èπÔ∏è Detener</button>
      </div>
    </div>
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 pb-4">
      <div class="grid grid-cols-2 sm:flex gap-2 sm:gap-3">
        <button data-tab="original" class="tab-btn tab-active rounded-xl px-4 py-2 text-sm">üìã Tabla Original</button>
        <button data-tab="1fn" class="tab-btn rounded-xl px-4 py-2 text-sm">1Ô∏è‚É£ Primera Forma Normal</button>
        <button data-tab="2fn" class="tab-btn rounded-xl px-4 py-2 text-sm">2Ô∏è‚É£ Segunda Forma Normal</button>
        <button data-tab="3fn" class="tab-btn rounded-xl px-4 py-2 text-sm">3Ô∏è‚É£ Tercera Forma Normal</button>
        <button data-tab="erd" class="tab-btn rounded-xl px-4 py-2 text-sm">üé® Diagrama Final</button>
      </div>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 pt-6 pb-20 space-y-8">
    <!-- ORIGINAL -->
    <section id="panel-original" class="panel">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 card-fun p-4 sm:p-6">
          <h2 class="text-2xl font-black mb-3">üìä Tabla Original (ventas consolidadas)</h2>
          <p class="text-slate-700 mb-4">Hoja de ventas con <span class="font-bold text-brand-600">productos listados en una sola celda</span> por factura (viola           1FN). Las columnas repiten datos de cliente, empleado y sucursal en cada fila.</p>
          <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
            <table class="min-w-full text-sm">
              <thead class="text-white">
                <tr>
                  <th class="px-4 py-3 text-left">Factura</th>
                  <th class="px-4 py-3 text-left">Fecha</th>
                  <th class="px-4 py-3 text-left">Cliente</th>
                  <th class="px-4 py-3 text-left">Empleado</th>
                  <th class="px-4 py-3 text-left">Sucursal</th>
                  <th class="px-4 py-3 text-left">Productos</th>
                </tr>
              </thead>
              <tbody id="tbody-original" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
        </div>
        <aside class="aside-card rounded-2xl shadow-pop p-4 sm:p-6">
          <h3 class="font-bold text-lg mb-3">Objetivo</h3>
          <div data-role="explanation" class="text-sm text-slate-800 mt-2 space-y-2">
            <p>Partimos de una hoja de c√°lculo t√≠pica. Corregiremos datos no at√≥micos (1FN), dependencias parciales (2FN) y transitivas (3FN) hasta llegar a un dise√±o robusto como el del esquema de Zapater√≠a.</p>
            <ul class="list-disc pl-5 space-y-1">
              <li>‚ú® 1FN: dividir productos en filas.</li>
              <li>üéØ 2FN: separar cabecera de factura de su detalle.</li>
              <li>üöÄ 3FN: usar tablas maestras y claves for√°neas.</li>
            </ul>
          </div>
        </aside>
      </div>
    </section>

    <!-- 1FN -->
    <section id="panel-1fn" class="panel hidden">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 card-fun p-4 sm:p-6">
          <h2 class="text-2xl font-black mb-3">1Ô∏è‚É£ Primera Forma Normal (1FN)</h2>
          <p class="text-slate-700 mb-4">Cada producto pasa a una fila. La clave es compuesta <code>(factura, item)</code>. A√∫n hay datos que dependen solo de la factura.</p>
          <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
            <table class="min-w-full text-sm">
              <thead class="text-white">
                <tr>
                  <th class="px-4 py-3 text-left">Factura</th>
                  <th class="px-4 py-3 text-left">Item</th>
                  <th class="px-4 py-3 text-left">SKU</th>
                  <th class="px-4 py-3 text-left">Talla</th>
                  <th class="px-4 py-3 text-left">Color</th>
                  <th class="px-4 py-3 text-left">Precio</th>
                  <th class="px-4 py-3 text-left">Cantidad</th>
                  <th class="px-4 py-3 text-left">Cliente</th>
                  <th class="px-4 py-3 text-left">Empleado</th>
                  <th class="px-4 py-3 text-left">Sucursal</th>
                </tr>
              </thead>
              <tbody id="tbody-1fn" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
        </div>
        <aside class="aside-card rounded-2xl shadow-pop p-4 sm:p-6">
          <h3 class="font-bold text-lg mb-3">¬øQu√© se corrigi√≥?</h3>
          <div data-role="explanation" class="text-sm text-slate-800 mt-2 space-y-2">
            <p>‚úÖ Los datos son at√≥micos: no hay listas en celdas. Sin embargo, <em class="font-bold">Cliente</em>, <em class="font-bold">Empleado</em> y <em class="font-bold">Sucursal</em> dependen solo de <strong>Factura</strong> (dependencia parcial). Lo arreglamos en 2FN.</p>
          </div>
        </aside>
      </div>
    </section>

    <!-- 2FN -->
    <section id="panel-2fn" class="panel hidden">
      <div class="grid gap-6">
        <div class="card-fun p-4 sm:p-6">
          <h2 class="text-2xl font-black mb-3">2Ô∏è‚É£ Segunda Forma Normal (2FN)</h2>
          <p class="text-slate-700 mb-4">Separamos cabecera y detalle para eliminar dependencias parciales:</p>
          <ul class="list-disc pl-5 text-slate-800 text-sm mb-4 space-y-1">
            <li>üìÑ <strong>Factura</strong>(<code>id_factura PK</code>, fecha_hora, cliente, empleado, sucursal)</li>
            <li>üìã <strong>DetalleFactura</strong>(<code>id_factura FK</code>, item, sku, talla, color, precio_unidad, cantidad)</li>
          </ul>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-bold mb-2">üìë Tabla: Factura (cabecera)</h3>
              <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                <table class="min-w-full text-sm">
                  <thead class="text-white">
                    <tr>
                      <th class="px-4 py-3 text-left">id_factura</th>
                      <th class="px-4 py-3 text-left">fecha_hora</th>
                      <th class="px-4 py-3 text-left">cliente</th>
                      <th class="px-4 py-3 text-left">empleado</th>
                      <th class="px-4 py-3 text-left">sucursal</th>
                    </tr>
                  </thead>
                  <tbody id="tbody-2fn-a" class="divide-y divide-slate-200"></tbody>
                </table>
              </div>
            </div>
            <div>
              <h3 class="font-bold mb-2">üìù Tabla: DetalleFactura</h3>
              <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                <table class="min-w-full text-sm">
                  <thead class="text-white">
                    <tr>
                      <th class="px-4 py-3 text-left">id_factura</th>
                      <th class="px-4 py-3 text-left">item</th>
                      <th class="px-4 py-3 text-left">sku</th>
                      <th class="px-4 py-3 text-left">talla</th>
                      <th class="px-4 py-3 text-left">color</th>
                      <th class="px-4 py-3 text-left">precio_unidad</th>
                      <th class="px-4 py-3 text-left">cantidad</th>
                    </tr>
                  </thead>
                  <tbody id="tbody-2fn-b" class="divide-y divide-slate-200"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <aside class="aside-card rounded-2xl shadow-pop p-4 sm:p-6">
          <h3 class="font-bold text-lg mb-3">¬øQu√© mejor√≥?</h3>
          <div data-role="explanation" class="text-sm text-slate-800 mt-2 space-y-2">
            <p>üéâ El detalle solo guarda informaci√≥n por √≠tem; los datos de cabecera viven en <em class="font-bold">Factura</em>. Se evita actualizar cliente/empleado/sucursal repetidamente por cada producto.</p>
          </div>
        </aside>
      </div>
    </section>

    <!-- 3FN -->
    <section id="panel-3fn" class="panel hidden">
      <div class="grid gap-6">
        <div class="card-fun p-4 sm:p-6">
          <h2 class="text-2xl font-black mb-3">3Ô∏è‚É£ Tercera Forma Normal (3FN)</h2>
          <p class="text-slate-700 mb-4">Creamos entidades maestras y claves for√°neas, alineadas con el <strong class="text-brand-600">esquema Zapater√≠a</strong>:</p>
          <div class="grid lg:grid-cols-2 gap-6">
            <div class="space-y-6">
              <div>
                <h3 class="font-bold mb-2">üë• Cliente</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_cliente</th>
                        <th class="px-4 py-3 text-left">apellidos</th>
                        <th class="px-4 py-3 text-left">nombres</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-3fn-clientes" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
              <div>
                <h3 class="font-bold mb-2">üë∑ Empleado</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_empleado</th>
                        <th class="px-4 py-3 text-left">nombres</th>
                        <th class="px-4 py-3 text-left">apellidos</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-3fn-empleados" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
              <div>
                <h3 class="font-bold mb-2">üè¢ Sucursal</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_sucursal</th>
                        <th class="px-4 py-3 text-left">nombre</th>
                      </tr>
                    </thead>
                                        <tbody id="tbody-3fn-sucursales" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="space-y-6">
              <div>
                <h3 class="font-bold mb-2">üëü ReferenciaProducto</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_referencia</th>
                        <th class="px-4 py-3 text-left">sku</th>
                        <th class="px-4 py-3 text-left">talla</th>
                        <th class="px-4 py-3 text-left">color</th>
                        <th class="px-4 py-3 text-left">precio</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-3fn-referencias" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
              <div>
                <h3 class="font-bold mb-2">üßæ Factura (FK a Cliente, Empleado, Sucursal)</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_factura</th>
                        <th class="px-4 py-3 text-left">fecha_hora</th>
                        <th class="px-4 py-3 text-left">id_cliente</th>
                        <th class="px-4 py-3 text-left">id_empleado</th>
                        <th class="px-4 py-3 text-left">id_sucursal</th>
                        <th class="px-4 py-3 text-left">total</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-3fn-facturas" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
              <div>
                <h3 class="font-bold mb-2">üìã DetalleFactura (FK a Factura y Referencia)</h3>
                <div class="overflow-auto rounded-xl border-3 border-black shadow-pop">
                  <table class="min-w-full text-sm">
                    <thead class="text-white">
                      <tr>
                        <th class="px-4 py-3 text-left">id_factura</th>
                        <th class="px-4 py-3 text-left">item</th>
                        <th class="px-4 py-3 text-left">id_referencia</th>
                        <th class="px-4 py-3 text-left">cantidad</th>
                        <th class="px-4 py-3 text-left">valor_unitario</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-3fn-detalle" class="divide-y divide-slate-200"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <aside class="aside-card rounded-2xl shadow-pop p-4 sm:p-6">
          <h3 class="font-bold text-lg mb-3">üéØ Resultado</h3>
          <div data-role="explanation" class="text-sm text-slate-800 mt-2 space-y-2">
            <p>üåü El dise√±o 3FN coincide con el <em class="font-bold">modelo Zapater√≠a</em>: datos maestros en sus tablas, y transacciones en <strong>Factura</strong> y <strong>DetalleFactura</strong>. Reglas de negocio (inventario, pagos, etc.) se integran mediante claves for√°neas.</p>
          </div>
        </aside>
      </div>
    </section>

    <!-- ERD -->
    <section id="panel-erd" class="panel hidden">
      <div class="card-fun p-4 sm:p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-black">üé® Diagrama Final Interactivo</h2>
          <div class="flex items-center gap-2">
            <button id="erd-zoom-in" class="rounded-xl bg-white px-3 py-2 text-sm border-2 border-black hover:shadow-pop hover:-translate-y-1 transition-all" title="Acercar">‚ûï</button>
            <button id="erd-zoom-out" class="rounded-xl bg-white px-3 py-2 text-sm border-2 border-black hover:shadow-pop hover:-translate-y-1 transition-all" title="Alejar">‚ûñ</button>
            <button id="erd-zoom-fit" class="rounded-xl bg-white px-3 py-2 text-sm border-2 border-black hover:shadow-pop hover:-translate-y-1 transition-all" title="Ajustar">üéØ Ajustar</button>
          </div>
        </div>
        
        <div id="erd-viewport" class="h-[70vh] overflow-hidden cursor-grab active:cursor-grabbing rounded-xl shadow-pop">
          <img id="erd-interactive-img" src="erd zapateria.jpg" alt="Diagrama ERD de la Zapater√≠a" class="max-w-none max-h-none transition-transform duration-100" style="transform-origin: 0 0;" />
        </div>
      </div>
      <aside class="aside-card rounded-2xl shadow-pop p-4 sm:p-6 mt-6">
        <h3 class="font-bold text-lg mb-3">üìñ Lectura r√°pida del ERD</h3>
        <div data-role="explanation" class="text-sm text-slate-800 mt-2 space-y-2">
          <p>üîó <strong>Factura</strong> referencia a Cliente, Empleado y Sucursal. <strong>DetalleFactura</strong> referencia a Factura y a <em class="font-bold">ReferenciaProducto</em>, que a su vez referencia a <em>Producto</em> y √©ste a <em>Marca</em> y <em>Categoria</em>. <em>Inventario</em> controla el stock por referencia y <em>Pago</em> enlaza con Factura.</p>
        </div>
      </aside>
    </section>
  </main>

  <footer>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 flex flex-col sm:flex-row items-center gap-3 sm:gap-6 text-sm">
      <span>¬© <span id="year"></span> üéâ Normalizaci√≥n 1FN‚Äì3FN ‚Ä¢ Caso Zapater√≠a.</span>
      <span class="hidden sm:inline">‚Ä¢</span>
      <span>üé§ Activa la voz para escuchar el resumen de cada secci√≥n.</span>
    </div>
  </footer>

  <!-- Elementos decorativos flotantes -->
  <div class="decoration-dot" style="top: 10%; left: 5%;"></div>
  <div class="decoration-dot" style="top: 80%; right: 10%; animation: bounce-slow 3s ease-in-out infinite;"></div>
  <div class="decoration-dot" style="top: 50%; left: 90%; background: #dc2626; animation: bounce-slow 2s ease-in-out infinite;"></div>

  <script>
    const $ = (q, el=document)=> el.querySelector(q);
    const $$ = (q, el=document)=> [...el.querySelectorAll(q)];

    // === Datos base: ventas consolidadas (violando 1FN) ===
    const originalRows = [
      { factura:'F-1001', fecha:'2025-08-01 10:32', cliA:'Celi Jim√©nez', cliN:'Andr√©s Felipe', empN:'Mar√≠a', empA:'G√≥mez', suc:'Centro', productos:'SKU-ABC-001:38:Negro:159000:2 | SKU-XYZ-110:40:Blanco:199000:1' },
      { factura:'F-1002', fecha:'2025-08-02 16:10', cliA:'Ram√≠rez P√©rez', cliN:'Claudia',      empN:'Carlos', empA:'Rubiano', suc:'Norte',  productos:'SKU-ABC-001:39:Negro:159000:1 | SKU-FFF-210:37:Rojo:129000:2' },
      { factura:'F-1003', fecha:'2025-08-03 11:05', cliA:'Kent',          cliN:'Clark',        empN:'Alex',   empA:'Arce',    suc:'Centro', productos:'SKU-XYZ-110:40:Blanco:199000:2' },
      { factura:'F-1004', fecha:'2025-08-04 09:20', cliA:'Pineda',        cliN:'Leonardo',     empN:'Luis',   empA:'S√°nchez', suc:'Sur',    productos:'SKU-AAA-777:42:Azul:179000:1 | SKU-XYZ-110:41:Blanco:199000:1' }
    ];

    function renderBody(tbody, rows, columns){
      tbody.innerHTML='';
      rows.forEach(r=>{
        const tr=document.createElement('tr'); tr.className='hover:bg-brand-50/50 transition-all duration-200';
        columns.forEach(c=>{ const td=document.createElement('td'); td.className='px-4 py-3 whitespace-nowrap'; td.textContent = r[c] ?? ''; tr.appendChild(td); });
        tbody.appendChild(tr);
      });
    }

    function renderOriginal(){
      const rows = originalRows.map(r=>({
        factura:r.factura, fecha:r.fecha,
        cliente:`${r.cliA}, ${r.cliN}`, empleado:`${r.empN} ${r.empA}`, sucursal:r.suc, productos:r.productos
      }));
      renderBody($('#tbody-original'), rows, ['factura','fecha','cliente','empleado','sucursal','productos']);
    }

    function parseProductos(s){
      return String(s).split('|').map(x=>x.trim()).filter(Boolean).map((t,i)=>{
        const [sku,talla,color,precio,cantidad] = t.split(':').map(x=>x.trim());
        return { item:i+1, sku, talla, color, precio:Number(precio), cantidad:Number(cantidad) };
      });
    }
    function to1FN(rows){
      const out=[];
      for(const r of rows){
        const items=parseProductos(r.productos);
        for(const it of items){
          out.push({ factura:r.factura, item:it.item, sku:it.sku, talla:it.talla, color:it.color, precio:it.precio, cantidad:it.cantidad,
            cliente:`${r.cliA}, ${r.cliN}`, empleado:`${r.empN} ${r.empA}`, sucursal:r.suc });
        }
      }
      return out;
    }
    function render1FN(){
      renderBody($('#tbody-1fn'), to1FN(originalRows), ['factura','item','sku','talla','color','precio','cantidad','cliente','empleado','sucursal']);
    }

    function to2FN(rows1){
      const cab=new Map(); const det=[]; const itemCounters={};
      for(const r of rows1){
        if(!cab.has(r.factura)) cab.set(r.factura,{ id_factura:r.factura, fecha_hora: originalRows.find(x=>x.factura===r.factura).fecha, cliente:r.cliente, empleado:r.empleado, sucursal:r.sucursal });
        if(!itemCounters[r.factura]) itemCounters[r.factura]=0; itemCounters[r.factura]++;
        det.push({ id_factura:r.factura, item:itemCounters[r.factura], sku:r.sku, talla:r.talla, color:r.color, precio_unidad:r.precio, cantidad:r.cantidad });
      }
      return { factura:[...cab.values()], detalle:det };
    }
    function render2FN(){
      const rows1 = to1FN(originalRows);
      const { factura, detalle } = to2FN(rows1);
      renderBody($('#tbody-2fn-a'), factura, ['id_factura','fecha_hora','cliente','empleado','sucursal']);
      renderBody($('#tbody-2fn-b'), detalle, ['id_factura','item','sku','talla','color','precio_unidad','cantidad']);
    }

        function to3FN(rows1){
      const uniq = arr => [...new Set(arr)];
      const clients = uniq(rows1.map(r=>`${r.cliente}`));
      const empleados = uniq(rows1.map(r=>`${r.empleado}`));
      const sucursales = uniq(rows1.map(r=>`${r.sucursal}`));
      const refs = uniq(rows1.map(r=>`${r.sku}|${r.talla}|${r.color}|${r.precio}`));
      const clientes = clients.map((n,i)=>{ const [apellidos, nombres]=n.split(',').map(x=>x.trim()); return { id_cliente:i+1, apellidos, nombres }; });
      const empleadosTbl = empleados.map((n,i)=>{ const parts=n.split(' '); const nombres=parts.slice(0,-1).join(' ')||n; const apellidos=parts.slice(-1).join(' '); return { id_empleado:i+1, nombres, apellidos }; });
      const sucTbl = sucursales.map((n,i)=>({ id_sucursal:i+1, nombre:n }));
      const refTbl = refs.map((s,i)=>{ const [sku,talla,color,precio]=s.split('|'); return { id_referencia:i+1, sku, talla, color, precio:Number(precio) }; });
      const idByCliente = Object.fromEntries(clientes.map(o=>[`${o.apellidos}, ${o.nombres}`, o.id_cliente]));
      const idByEmpleado = Object.fromEntries(empleadosTbl.map(o=>[`${o.nombres} ${o.apellidos}`.trim(), o.id_empleado]));
      const idBySucursal = Object.fromEntries(sucTbl.map(o=>[o.nombre, o.id_sucursal]));
      const idByRef = Object.fromEntries(refTbl.map(o=>[o.sku+"|"+o.talla+"|"+o.color+"|"+o.precio, o.id_referencia]));
      const facturasMap = new Map();
      const detalle = [];
      for(const r of rows1){
        const key=r.factura;
        const id_cliente=idByCliente[r.cliente];
        const id_empleado=idByEmpleado[r.empleado];
        const id_sucursal=idBySucursal[r.sucursal];
        if(!facturasMap.has(key)) facturasMap.set(key,{ id_factura:key, fecha_hora: originalRows.find(x=>x.factura===key).fecha, id_cliente, id_empleado, id_sucursal, total:0 });
        const refKey = `${r.sku}|${r.talla}|${r.color}|${r.precio}`;
        const id_referencia=idByRef[refKey];
        const item=(detalle.filter(d=>d.id_factura===key).length)+1;
        detalle.push({ id_factura:key, item, id_referencia, cantidad:r.cantidad, valor_unitario:r.precio });
        facturasMap.get(key).total += r.cantidad*r.precio;
      }
      const facturas = [...facturasMap.values()].map(f=>({ ...f, total: Number(f.total.toFixed(2)) }));
      return { clientes, empleados:empleadosTbl, sucursales:sucTbl, referencias:refTbl, facturas, detalle };
    }
    function render3FN(){
      const rows1 = to1FN(originalRows);
      const { clientes, empleados, sucursales, referencias, facturas, detalle } = to3FN(rows1);
      renderBody($('#tbody-3fn-clientes'), clientes, ['id_cliente','apellidos','nombres']);
      renderBody($('#tbody-3fn-empleados'), empleados, ['id_empleado','nombres','apellidos']);
      renderBody($('#tbody-3fn-sucursales'), sucursales, ['id_sucursal','nombre']);
      renderBody($('#tbody-3fn-referencias'), referencias, ['id_referencia','sku','talla','color','precio']);
      renderBody($('#tbody-3fn-facturas'), facturas, ['id_factura','fecha_hora','id_cliente','id_empleado','id_sucursal','total']);
      renderBody($('#tbody-3fn-detalle'), detalle, ['id_factura','item','id_referencia','cantidad','valor_unitario']);
    }

    // === L√≥gica de Voz y Pesta√±as ===
    let voiceEnabled = false;
    let selectedVoice = null;
    
    // Objeto para manejar el estado del visor ERD
    const erdState = {
      scale: 1, panX: 0, panY: 0,
      isPanning: false, startX: 0, startY: 0,
      viewport: null, image: null
    };

    function switchTo(tab){
      $$('.tab-btn').forEach(b=> b.classList.toggle('tab-active', b.dataset.tab===tab));
      $$('.panel').forEach(p=>{ 
        if(p.id==='panel-'+tab){ 
          p.classList.remove('hidden'); 
          p.style.animation = 'none';
          p.offsetHeight; // trigger reflow
          p.style.animation = 'slideIn 0.5s ease-out';
        } else { 
          p.classList.add('hidden'); 
        } 
      });
      
      // Si la pesta√±a seleccionada es el diagrama, se ajusta autom√°ticamente
      if (tab === 'erd') {
        resetERDView();
      }
      if(voiceEnabled) speakCurrentSummary();
    }
    
    function getPreferredVoice(){
      const voices = window.speechSynthesis.getVoices();
      if(!voices.length) return null;
      const prefs = [
        v => v.lang?.toLowerCase().includes('es-419') && /google|microsoft/i.test(v.name),
        v => v.lang?.toLowerCase().startsWith('es') && /google|microsoft|natural/i.test(v.name),
        v => v.lang?.toLowerCase().startsWith('es')
      ];
      for(const rule of prefs){ const found = voices.find(rule); if(found) return found; }
      return voices[0];
    }
    
    function speakText(text){
      try{
        if(!('speechSynthesis'in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(String(text||''));
        u.lang = (selectedVoice && selectedVoice.lang)?selectedVoice.lang:'es-ES';
        if(selectedVoice) u.voice = selectedVoice;
        u.rate = 1;
        window.speechSynthesis.speak(u);
      }catch(e){console.warn('TTS error', e);}
    }

    function speakCurrentSummary(){
      if(!voiceEnabled) return;
      const activeTab = $('.tab-active')?.dataset.tab || 'original';
      const panel = $('#panel-'+activeTab);
      let text = panel?.querySelector('[data-role="explanation"]')?.innerText.trim() || '';
      if(!text) text = ({
          original: '¬°Hola! Estamos viendo la tabla original con productos listados en una sola celda por factura, lo cual viola la primera forma normal. ¬°Vamos a arreglarlo!',
          '1fn': '¬°Genial! En la primera forma normal, cada producto ocupa su propia fila. La clave es factura y item. Ya se ve mucho mejor, ¬øverdad?',
          '2fn': '¬°Excelente progreso! En la segunda forma normal hemos separado la cabecera del detalle para eliminar las dependencias parciales.',
          '3fn': '¬°Lo logramos! En la tercera forma normal tenemos tablas maestras con claves for√°neas. ¬°La normalizaci√≥n est√° completa!',
          erd: '¬°Aqu√≠ est√° nuestro hermoso diagrama final! Muestra las relaciones entre facturas, clientes, empleados, sucursales y referencias de productos.'
        })[activeTab] || 'Resumen no disponible.';
      speakText(text);
    }

    document.addEventListener('change', (e)=>{
      if(e.target?.id==='voice-select'){
        const name = e.target.value;
        selectedVoice = window.speechSynthesis.getVoices().find(x=>x.name===name) || getPreferredVoice();
      }
    });
    
    // === L√≥gica del visor interactivo del ERD ===
    const updateERDTransform = () => {
      if (erdState.image) erdState.image.style.transform = `translate(${erdState.panX}px, ${erdState.panY}px) scale(${erdState.scale})`;
    };
    
    const resetERDView = () => {
      const { image, viewport } = erdState;
      if (!image || !viewport || image.naturalWidth === 0 || viewport.clientWidth === 0) return;
      
      erdState.scale = viewport.clientWidth / image.naturalWidth;
      erdState.panX = 0;
      erdState.panY = 0;
      updateERDTransform();
    };

    function setupInteractiveERD() {
      erdState.viewport = $('#erd-viewport');
      erdState.image = $('#erd-interactive-img');
      const { viewport, image } = erdState;
      if (!viewport || !image) return;

      image.onload = resetERDView;
      if (image.complete) resetERDView();
      
      $('#erd-zoom-in')?.addEventListener('click', () => { erdState.scale = Math.min(4, erdState.scale * 1.25); updateERDTransform(); });
      $('#erd-zoom-out')?.addEventListener('click', () => { erdState.scale = Math.max(0.2, erdState.scale / 1.25); updateERDTransform(); });
      $('#erd-zoom-fit')?.addEventListener('click', resetERDView);
      
      viewport.addEventListener('mousedown', (e) => {
        e.preventDefault(); erdState.isPanning = true;
        erdState.startX = e.clientX - erdState.panX; erdState.startY = e.clientY - erdState.panY;
      });
      document.addEventListener('mousemove', (e) => {
        if (!erdState.isPanning) return;
        erdState.panX = e.clientX - erdState.startX; erdState.panY = e.clientY - erdState.startY;
        updateERDTransform();
      });
      document.addEventListener('mouseup', () => { erdState.isPanning = false; });
      viewport.addEventListener('wheel', (e) => {
        e.preventDefault();
        const rect = viewport.getBoundingClientRect();
        const mouseX = e.clientX - rect.left; const mouseY = e.clientY - rect.top;
        const scaleAmount = 1 - e.deltaY * 0.001;
        const newScale = Math.max(0.2, Math.min(4, erdState.scale * scaleAmount));
        erdState.panX = mouseX - (mouseX - erdState.panX) * (newScale / erdState.scale);
        erdState.panY = mouseY - (mouseY - erdState.panY) * (newScale / erdState.scale);
        erdState.scale = newScale;
        updateERDTransform();
      });
      
      // Observador para reajustar si cambia el tama√±o de la ventana/contenedor
      new ResizeObserver(resetERDView).observe(viewport);
    }

    function init(){
      $('#year').textContent = new Date().getFullYear();
      renderOriginal(); render1FN(); render2FN(); render3FN();
      $$('.tab-btn').forEach(b=> b.addEventListener('click', ()=> switchTo(b.dataset.tab)));
      $('#btn-voice').addEventListener('click', ()=>{ 
        voiceEnabled=true; 
        speakCurrentSummary(); 
        // A√±adir animaci√≥n al bot√≥n cuando se activa
        event.target.classList.add('animate-bounce');
        setTimeout(() => event.target.classList.remove('animate-bounce'), 1000);
      });
      $('#btn-stop-voice').addEventListener('click', ()=> {
        window.speechSynthesis?.cancel();
        voiceEnabled = false;
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      window.speechSynthesis.onvoiceschanged = () => {
        const voices = window.speechSynthesis.getVoices();
        const select = $('#voice-select');
        select.innerHTML = `<option value="">üé§ Voz (auto)</option>${voices.map(v => `<option value="${v.name}">${v.name} (${v.lang})</option>`).join('')}`;
        selectedVoice = getPreferredVoice();
      };
      init();
      setupInteractiveERD();
    });
  </script>
</body>
</html>
